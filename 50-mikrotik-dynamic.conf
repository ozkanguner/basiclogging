# MikroTik Dynamic Zone/Device Logging Configuration
# Otomatik klasör oluşturma ve günlük dosyalar
# Ana mikrotik klasörü olmadan direkt /var/log/ altında

# Klasör oluşturma modülünü etkinleştir
$CreateDirs on
$DirCreateMode 0755
$FileCreateMode 0644

# Dynamic template tanımla - Cihaz adı ve interface'e göre
$template InterfaceTemplate,"/var/log/%fromhost%/%msg:R,ERE,1,FIELD:in:([A-Za-z0-9_]+)--end%/%$year%-%$month%-%$day%.log"

# Genel template - interface bilgisi olmadığında
$template GeneralTemplate,"/var/log/%fromhost%/genel/%$year%-%$month%-%$day%.log"

# MikroTik loglarını filtrele ve yönlendir
if $fromhost contains "hotspot" or $msg contains "forward:" then {
    # Interface adını çıkarmaya çalış
    if $msg contains "in:" then {
        ?InterfaceTemplate
    } else {
        # Interface bilgisi yoksa genel klasöre at
        ?GeneralTemplate
    }
    & stop
}

# Tüm MikroTik cihazları için fallback (IP bazında)
if $fromhost-ip startswith "172." or $fromhost-ip startswith "192.168." then {
    /var/log/%fromhost%/other/%$year%-%$month%-%$day%.log
    & stop
} 